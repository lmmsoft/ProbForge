# Meme æ¦‚ç‡åè®® - Hardhat éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç›®å½•

- [ç¯å¢ƒå‡†å¤‡](#ç¯å¢ƒå‡†å¤‡)
- [åˆçº¦éƒ¨ç½²é€»è¾‘](#åˆçº¦éƒ¨ç½²é€»è¾‘)
- [æœ¬åœ°æµ‹è¯•](#æœ¬åœ°æµ‹è¯•)
- [éƒ¨ç½²åˆ°æµ‹è¯•ç½‘](#éƒ¨ç½²åˆ°æµ‹è¯•ç½‘)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£… Node.js (æ¨è v20 LTS)

```bash
# æ£€æŸ¥ç‰ˆæœ¬
node -v

# å¦‚æœç‰ˆæœ¬ä¸å¯¹ï¼Œä½¿ç”¨ nvm å®‰è£…
nvm install 20
nvm use 20
```

### 2. å®‰è£…ä¾èµ–

```bash
cd hardhat
npm install
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env`ï¼š

```env
PRIVATE_KEY=your_private_key_here
RPC_URL=https://sepolia.base.org
BASESCAN_API_KEY=your_basescan_api_key
```

âš ï¸ **é‡è¦**: ä¸è¦æäº¤ `.env` æ–‡ä»¶åˆ° Gitï¼

---

## åˆçº¦éƒ¨ç½²é€»è¾‘

### éƒ¨ç½²é¡ºåº

```
1. MockUSDC (ERC20 ä»£å¸)
   â†“
2. Settlement (ç»“ç®—åˆçº¦)
   â†“
3. MarketFactory (å·¥å‚åˆçº¦)
   â†“
4. Market (é€šè¿‡ Factory åˆ›å»º)
```

### ä¸ºä»€ä¹ˆè¿™ä¸ªé¡ºåºï¼Ÿ

#### 1. **MockUSDC æœ€å…ˆéƒ¨ç½²**

```solidity
// MarketFactory éœ€è¦
constructor(
    address _collateralToken,  // â† MockUSDC åœ°å€
    ...
)

// Settlement éœ€è¦
constructor(address _collateralToken) { // â† MockUSDC åœ°å€
    ...
}
```

#### 2. **Settlement åœ¨ MarketFactory ä¹‹å‰éƒ¨ç½²**

è™½ç„¶ Settlement ä¸ç›´æ¥è¢« Factory å¼•ç”¨ï¼Œä½†éœ€è¦åœ¨éƒ¨ç½²è®°å½•ä¸­ä¿å­˜å…¶åœ°å€ï¼Œä¾¿äºåç»­ç»“ç®—å¸‚åœºã€‚

#### 3. **Market é€šè¿‡ CREATE2 åˆ›å»º**

```solidity
// MarketFactory.sol
bytes32 salt = keccak256(abi.encodePacked(
    msg.sender,      // åˆ›å»ºè€…
    block.timestamp, // æ—¶é—´æˆ³
    question         // é—®é¢˜æè¿°
));

market = address(new Market{salt: salt}(...));
```

**CREATE2 çš„ä¼˜åŠ¿**:
- âœ… å¯é¢„æµ‹åœ°å€ï¼ˆåœ¨åˆ›å»ºå‰å°±èƒ½è®¡ç®—ï¼‰
- âœ… é˜²æ­¢é‡å¤åˆ›å»ºç›¸åŒé—®é¢˜
- âœ… èŠ‚çœ Gas

### 4. **å‚æ•°è¯´æ˜**

#### MockUSDC

```solidity
constructor()
```

- æ— å‚æ•°
- è‡ªåŠ¨é“¸é€  1,000,000 USDC ç»™éƒ¨ç½²è€…

#### Settlement

```solidity
constructor(address _collateralToken)
```

- `_collateralToken`: USDC åˆçº¦åœ°å€
- è®¾ç½®æœ€ä½ä¿è¯é‡‘: 100 USDC
- è®¾ç½®æŒ‘æˆ˜æœŸ: 3 å¤©

#### MarketFactory

```solidity
constructor(
    address _collateralToken,  // USDC åœ°å€
    uint256 _creationBond,      // åˆ›å»ºä¿è¯é‡‘ (0.01 ETH)
    address _treasury           // è´¢åº“åœ°å€ (æ¥æ”¶ä¿è¯é‡‘)
)
```

**å‚æ•°è§£é‡Š**:
- `creationBond`: é˜²æ­¢åƒåœ¾åˆ›å»ºï¼Œæ”¶å– 0.01 ETH
- `treasury`: è´¢åº“åœ°å€ï¼Œé€šå¸¸è®¾ç½®ä¸ºéƒ¨ç½²è€…æˆ–å¤šç­¾åœ°å€

---

## æœ¬åœ°æµ‹è¯•

### 1. ç¼–è¯‘åˆçº¦

```bash
npx hardhat compile
```

è¾“å‡ºï¼š
```
Compiled 13 Solidity files successfully
```

### 2. è¿è¡Œæµ‹è¯•

```bash
npx hardhat test
```

é¢„æœŸè¾“å‡ºï¼š
```
Meme æ¦‚ç‡åè®® - å®Œæ•´æµ‹è¯•

=== æµ‹è¯•è´¦æˆ· ===
Owner: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266
User1: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8

âœ… MockUSDC éƒ¨ç½²åˆ°: 0x5FbDB2315678afecb367f032d93F642f64180aa3
âœ… Settlement éƒ¨ç½²åˆ°: 0x9fE46736679d2D9a65F0992F2272dE9f3c7fa6e0
âœ… MarketFactory éƒ¨ç½²åˆ°: 0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9

  10 passing (565ms)
```

### 3. æµ‹è¯•è¦†ç›–ç‡

```bash
npx hardhat coverage
```

---

## éƒ¨ç½²åˆ°æµ‹è¯•ç½‘

### 1. Base Sepolia æµ‹è¯•ç½‘é…ç½®

ç¡®ä¿ `.env` æ–‡ä»¶é…ç½®æ­£ç¡®ï¼š

```env
PRIVATE_KEY=your_base_sepolia_private_key
RPC_URL=https://sepolia.base.org
```

### 2. è·å–æµ‹è¯• ETH

- [Base Sepolia Faucet](https://sepoliafaucet.com)
- [Coinbase Sepolia Faucet](https://www.coinbase.com/faucets/ethereum-sepolia)

### 3. éƒ¨ç½²åˆçº¦

```bash
npx hardhat run scripts/deploy.js --network sepolia
```

é¢„æœŸè¾“å‡ºï¼š

```
=== å¼€å§‹éƒ¨ç½² Meme æ¦‚ç‡åè®®åˆçº¦ ===

éƒ¨ç½²è´¦æˆ·: 0x...
è´¦æˆ·ä½™é¢: 1.234 ETH

ğŸ“¦ 1/4 éƒ¨ç½² MockUSDC...
âœ… MockUSDC éƒ¨ç½²åˆ°: 0x...
   å·²é“¸é€  100,000 USDC ç»™éƒ¨ç½²è€…

ğŸ“¦ 2/4 éƒ¨ç½² Settlement...
âœ… Settlement éƒ¨ç½²åˆ°: 0x...

ğŸ“¦ 3/4 éƒ¨ç½² MarketFactory...
âœ… MarketFactory éƒ¨ç½²åˆ°: 0x...
   æŠµæŠ¼ä»£å¸: 0x...
   åˆ›å»ºä¿è¯é‡‘: 0.01 ETH
   è´¢åº“åœ°å€: 0x...

=== éƒ¨ç½²å®Œæˆ ===
ç½‘ç»œ: sepolia
Chain ID: 84532

åˆçº¦åœ°å€:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
MockUSDC:     0x...
Settlement:   0x...
MarketFactory: 0x...
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

### 4. éªŒè¯éƒ¨ç½² (å¯é€‰)

åœ¨ [BaseScan](https://sepolia.basescan.org/) éªŒè¯åˆçº¦ï¼š

```bash
npx hardhat verify --network sepolia <contract_address> <constructor_args>
```

---

## åˆ›å»ºæµ‹è¯•å¸‚åœº

### ä½¿ç”¨è„šæœ¬åˆ›å»º

```bash
npx hardhat run scripts/create-market.js --network sepolia
```

é¢„æœŸè¾“å‡ºï¼š

```
=== åˆ›å»ºé¢„æµ‹å¸‚åœº ===

Factory åœ°å€: 0x...
USDC åœ°å€: 0x...

åˆ›å»ºè€…: 0x...
ä½™é¢: 1.234 ETH

=== å¸‚åœºå‚æ•° ===
é—®é¢˜: æ¯”ç‰¹å¸åœ¨ 2025 å¹´åº•èƒ½çªç ´ $150,000?
æ¨¡æ¿ ID: 0 (äºŒå…ƒé€‰é¡¹)
ç»“ç®—æ—¶é—´: 2025-01-11T12:00:00.000Z
åˆå§‹ YES ä»·æ ¼: 50.0 %
åˆ›å»ºä¿è¯é‡‘: 0.01 ETH

â³ åˆ›å»ºå¸‚åœº...
äº¤æ˜“å“ˆå¸Œ: 0x...
ç­‰å¾…ç¡®è®¤...
âœ… äº¤æ˜“å·²ç¡®è®¤! Gas ç”¨é‡: 2345678

=== å¸‚åœºåˆ›å»ºæˆåŠŸ ===
å¸‚åœºåœ°å€: 0x...
é—®é¢˜ ID: 0
å‚æ•°å“ˆå¸Œ: 0x...
```

---

## åˆçº¦æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Meme æ¦‚ç‡åè®®                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         MarketFactory (å·¥å‚)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ åˆ›å»ºä¿è¯é‡‘ (0.01 ETH)                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ è´¢åº“ç®¡ç†                                 â”‚  â”‚
â”‚  â”‚  â””â”€ CREATE2 éƒ¨ç½² Market                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                   â”‚
â”‚                  â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           Market (å¸‚åœº)                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Stage 0: AMM (Bonding Curve)            â”‚  â”‚
â”‚  â”‚  â”œâ”€ Stage 1: Hybrid (AMM + Orderbook)        â”‚  â”‚
â”‚  â”‚  â”œâ”€ Stage 2: Orderbook                      â”‚  â”‚
â”‚  â”‚  â”œâ”€ Trading (YES/NO)                         â”‚  â”‚
â”‚  â”‚  â””â”€ Stage Upgrades                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                  â”‚                                   â”‚
â”‚                  â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚        Settlement (ç»“ç®—)                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ æäº¤ç»“æœ                                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ æŒ‘æˆ˜æœŸ (3 å¤©)                           â”‚  â”‚
â”‚  â”‚  â””â”€ æœ€ç»ˆåŒ–                                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          MockUSDC (æŠµæŠ¼ä»£å¸)                 â”‚  â”‚
â”‚  â”‚  â”œâ”€ ERC20 (6 ä½å°æ•°)                         â”‚  â”‚
â”‚  â”‚  â””â”€ Faucet (æ°´é¾™å¤´)                          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Gas è´¹ç”¨ä¼°ç®—

### éƒ¨ç½²æˆæœ¬ (Base Sepolia)

| åˆçº¦ | Gas ç”¨é‡ | ETH è´¹ç”¨ (20 gwei) |
|------|---------|-------------------|
| MockUSDC | ~800,000 | ~0.016 ETH |
| Settlement | ~1,200,000 | ~0.024 ETH |
| MarketFactory | ~2,500,000 | ~0.05 ETH |
| **æ€»è®¡** | **~4,500,000** | **~0.09 ETH** |

### äº¤æ˜“æˆæœ¬

| æ“ä½œ | Gas ç”¨é‡ | è´¹ç”¨ |
|------|---------|------|
| åˆ›å»ºå¸‚åœº | ~2,300,000 | ~0.046 ETH |
| ä¹°å…¥ YES/NO | ~150,000 | ~0.003 ETH |
| å–å‡º YES/NO | ~120,000 | ~0.0024 ETH |
| å‡çº§ Stage | ~50,000 | ~0.001 ETH |

---

## å…³é”®å‡½æ•°è°ƒç”¨

### 1. åˆ›å»ºå¸‚åœº

```solidity
factory.createMarket(
    "æ¯”ç‰¹å¸å¹´åº•èƒ½çªç ´ $100k?",  // question
    0,                           // templateId (äºŒå…ƒ)
    1735689600,                 // resolutionTime
    ethers.parseEther("0.5"),  // initialYesPrice
    { value: ethers.parseEther("0.01") } // creationBond
)
```

### 2. AMM ä¹°å…¥

```solidity
// ä¹°å…¥ YES
market.buy(0, ethers.parseUnits("100", 6))  // side=0, amountIn=100 USDC

// ä¹°å…¥ NO
market.buy(1, ethers.parseUnits("100", 6))  // side=1, amountIn=100 USDC
```

### 3. æŸ¥è¯¢ä»·æ ¼

```solidity
// YES ä»·æ ¼
const yesPrice = await market.getYesPrice()  // è¿”å› 0.5 = 50%

// NO ä»·æ ¼
const noPrice = await market.getNoPrice()    // è¿”å› 0.5 = 50%

// é¢„ä¼°äº¤æ˜“
const [sharesOut, price] = await market.getBuyOutcome(
    0,                           // side (YES)
    ethers.parseUnits("50", 6)  // amountIn (50 USDC)
)
```

### 4. æäº¤ç»“ç®—

```solidity
settlement.proposeSettlement(
    marketAddress,  // å¸‚åœºåœ°å€
    true            // ç»“æœ (true=YES, false=NO)
)
```

---

## å¸¸è§é—®é¢˜

### Q1: ç¼–è¯‘å¤±è´¥ "File @openzeppelin/contracts/... not found"

**è§£å†³æ–¹æ¡ˆ**:
```bash
npm install @openzeppelin/contracts@^4.9.3
```

### Q2: è¿è¡Œæµ‹è¯•æ—¶ Node.js ç‰ˆæœ¬è­¦å‘Š

**è§£å†³æ–¹æ¡ˆ** (å¯é€‰):
```bash
nvm install 20
nvm use 20
```

### Q3: ç§é’¥æ ¼å¼é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
- ç§é’¥ä¸è¦å¸¦ `0x` å‰ç¼€
- æˆ–æ·»åŠ  `0x` å‰ç¼€: `PRIVATE_KEY=0xabc123...`

### Q4: Gas ä¸è¶³

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®ä¿é’±åŒ…æœ‰è¶³å¤Ÿçš„æµ‹è¯• ETH
- ä½¿ç”¨æ°´é¾™å¤´: https://sepoliafaucet.com

### Q5: CREATE2 åœ°å€å†²çª

**è§£å†³æ–¹æ¡ˆ**:
- Salt åŒ…å« `block.timestamp` ç¡®ä¿å”¯ä¸€æ€§
- æˆ–è€…åœ¨ salt ä¸­åŠ å…¥ nonce

---

## ä¸‹ä¸€æ­¥

- [ ] åœ¨ Base Sepolia å®Œæ•´æµ‹è¯•
- [ ] éƒ¨ç½²åˆ° Base Mainnet
- [ ] å®ç°å‰ç«¯äº¤äº’
- [ ] æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0
**æœ€åæ›´æ–°**: 2025-02-11
